var archivo_juego=document.createElement('input');archivo_juego.setAttribute('type','file');archivo_juego.setAttribute('accept','.hpg');archivo_juego.setAttribute('onchange','cargar_proyecto()');var lector;var elemento=document.createElement('a');var nodo_actual=0;var estructura_datos={};var cantidad_opciones=0;var tam_fuente=16;function mostrar(tipo,accion){let elem=document.getElementById("contenido_"+tipo);if(accion==="alternar"){let estilo=window.getComputedStyle(elem);let display=estilo.getPropertyValue('display');if(display==="none"){elem.style.display="flex";}else if(display==="flex"){elem.style.display="none";};};if(accion==="cerrar"){elem.style.display="none";};};window.addEventListener("beforeunload",function(event){guardar_nodo();estructura_datos['titulo']=document.getElementById('titulo').innerHTML;guardar_sesion();event.returnValue="";});function iniciar(){cargar_estructura();agregar_nodo(false);confirmar_sesion();};function cargar_sesion(){estructura_datos=JSON.parse(localStorage.getItem("todo_datos"));cargar_datos_sesion();};function guardar_sesion(){localStorage.setItem("todo_datos",JSON.stringify(estructura_datos));};function confirmar_sesion(){let respuesta=confirm("¿Desear cargar la sesión anterior?");if(respuesta){cargar_sesion();} else{guardar_sesion();};};function cargar_estructura(){estructura_datos["id"]="1";estructura_datos["titulo"]="";estructura_datos["inicio"]=0;estructura_datos["datos"]=[];};function abrir_proyecto(){archivo_juego.click();};function cargar_proyecto(){let archivo=archivo_juego.files[0];lector=new FileReader();lector.readAsText(archivo);lector.onload=cargar_datos_proyecto;lector.onerror=mostrar_error;};function cargar_datos_proyecto(){let parsear=lector.result;estructura_datos=JSON.parse(parsear);document.getElementById('titulo').innerHTML=estructura_datos['titulo'];nodo_actual=estructura_datos['inicio'];cargar_nodo(nodo_actual);};function cargar_datos_sesion(){document.getElementById('titulo').innerHTML=estructura_datos['titulo'];nodo_actual=estructura_datos['inicio'];cargar_nodo(nodo_actual);};function mostrar_error(){alert('Ha ocurrido un error al cargar el juego, intentalo de nuevo.');};function guardar_proyecto(){guardar_nodo();estructura_datos['titulo']=document.getElementById('titulo').innerHTML;guardar_sesion();let texto_guardar=JSON.stringify(estructura_datos);elemento.setAttribute('href','data:text/plain;charset=utf-8,'+encodeURIComponent(texto_guardar));elemento.setAttribute('download',estructura_datos['titulo']+'.hpg');elemento.click();};function actualizar_max_nodos(){document.getElementById("max_nodos").innerHTML=estructura_datos["datos"].length-1;let lista_input=document.getElementsByClassName("numero");for(let i=0;i<lista_input.length;i++){lista_input[i].setAttribute("max",estructura_datos["datos"].length-1);};};function agregar_nodo(medio){if(medio===true){let nodo={};nodo["texto"]="";nodo["opciones"]=[];estructura_datos["datos"].splice(nodo_actual+1,0,nodo);}else{let nodo={};nodo["texto"]="";nodo["opciones"]=[];estructura_datos["datos"].push(nodo);document.getElementById('nodo_actual').innerHTML=nodo_actual;};actualizar_max_nodos();};function eliminar_nodo(){estructura_datos["datos"].splice(nodo_actual,1);limpiar_nodo();let n_tamanio=estructura_datos["datos"].length;if(n_tamanio==0){agregar_nodo(false);nodo_actual=0;actualizar_max_nodos();}else{let nuevo_nodo=parseInt(nodo_actual)-1;if(nuevo_nodo>=0){cargar_nodo(nuevo_nodo);nodo_actual=nuevo_nodo;document.getElementById('nodo_actual').innerHTML=nodo_actual;actualizar_max_nodos();}else{cargar_nodo(nodo_actual);actualizar_max_nodos();};};};function movimiento_nodos(direccion){let nuevo_nodo=0;if(direccion){nuevo_nodo=parseInt(nodo_actual)+1;}else{if(nodo_actual>0){nuevo_nodo=parseInt(nodo_actual)-1;};};let existe_nodo;existe_nodo=estructura_datos["datos"][nuevo_nodo];if(existe_nodo!==undefined){guardar_nodo();limpiar_nodo();cargar_nodo(nuevo_nodo);nodo_actual=nuevo_nodo;document.getElementById('nodo_actual').innerHTML=nodo_actual;};};function avanzar(dir){let elemento_direccion=document.getElementById(dir);let dir_nodo=(elemento_direccion.value).toString();let comprobador=estructura_datos["datos"][dir_nodo];if(comprobador!==undefined){guardar_nodo();limpiar_nodo();cantidad_opciones=0;cargar_nodo(dir_nodo);nodo_actual=dir_nodo;document.getElementById('nodo_actual').innerHTML=nodo_actual;}else{alert('El nodo indicado aún no existe');};};function eliminar_opcion(n_opcion){let opcion_eliminar=document.getElementById("opcion_" + n_opcion.toString());opcion_eliminar.remove();guardar_nodo();cantidad_opciones=estructura_datos["datos"][nodo_actual]["opciones"].length;};function cargar_nodo(numero_nodo){let nodo_existe=estructura_datos["datos"][numero_nodo];document.getElementById('contenido').innerHTML=nodo_existe["texto"];cantidad_opciones=0;for(let i=0;i<nodo_existe["opciones"].length;i++){agregar_opcion();};let listado_texto_opciones=document.getElementsByClassName('texto');let listado_direcciones=document.getElementsByClassName('numero');for(let i=0;i < nodo_existe["opciones"].length;i++){listado_texto_opciones[i].innerHTML=nodo_existe["opciones"][i]["texto"];listado_direcciones[i].value=nodo_existe["opciones"][i]["direccion"];};};function guardar_nodo(){let datos_nodo_actual=estructura_datos["datos"][nodo_actual];let lista_textos=document.getElementsByClassName('texto');let lista_direcciones=document.getElementsByClassName('numero');let listado_opciones=[];for(let i=0;i < lista_textos.length;i++){let opcion={};opcion["texto"]=lista_textos[i].innerHTML;opcion["direccion"]=lista_direcciones[i].value;listado_opciones.push(opcion);};datos_nodo_actual["texto"]=document.getElementById('contenido').innerHTML;datos_nodo_actual["opciones"]=listado_opciones;};function limpiar_nodo(){document.getElementById('contenido').innerHTML='';document.getElementById('elecciones').innerHTML='';};function agregar_opcion(){let elem_contendor=document.createElement('div');elem_contendor.id='opcion_'+cantidad_opciones.toString();elem_contendor.className='contenedor';let elem_texto=document.createElement('div');elem_texto.setAttribute('contenteditable',true);elem_texto.className='texto';let elem_numero=document.createElement('input');elem_numero.id=cantidad_opciones.toString();elem_numero.setAttribute('placeholder','0');elem_numero.setAttribute('type','number');elem_numero.setAttribute('min','0');elem_numero.setAttribute('max',estructura_datos["datos"].length-1);elem_numero.setAttribute('step','1');elem_numero.className='numero';let elem_avanzar=document.createElement('div');elem_avanzar.id=cantidad_opciones.toString();elem_avanzar.setAttribute('title','Ir al diálogo');elem_avanzar.setAttribute('onclick','avanzar('+cantidad_opciones.toString()+')');elem_avanzar.className='boton';elem_avanzar.innerHTML='<img src="../svg/f_der.svg"></img>';let elem_eliminar=document.createElement('div');elem_eliminar.id=cantidad_opciones.toString();elem_eliminar.setAttribute('title','Eliminar');elem_eliminar.setAttribute('onclick','eliminar_opcion('+cantidad_opciones.toString()+')');elem_eliminar.className='boton';elem_eliminar.innerHTML='<img src="../svg/eliminar.svg"></img>';elem_contendor.appendChild(elem_texto);elem_contendor.appendChild(elem_numero);elem_contendor.appendChild(elem_avanzar);elem_contendor.appendChild(elem_eliminar);document.getElementById('elecciones').appendChild(elem_contendor);cantidad_opciones+=1;};function pantalla(){if(document.documentElement.requestFullscreen){document.documentElement.requestFullscreen();};};function cambiar(direccion){if(direccion){tam_fuente+=2;}else{tam_fuente-=2;};if(tam_fuente<16){tam_fuente=16;}if(tam_fuente>28){tam_fuente=28;}document.getElementById("contenido").style.fontSize=tam_fuente.toString()+"px";};function comandos(tipo){switch(tipo){case 0:document.execCommand('bold');break;case 1:document.execCommand('italic');break;case 2:document.execCommand('underline');break;case 3:document.execCommand('strikeThrough');break;case 4:document.execCommand('subscript');break;case 5:document.execCommand('superscript');break;case 6:document.execCommand('justifyLeft');break;case 7:document.execCommand('justifyCenter');break;case 8:document.execCommand('justifyRight');break;case 9:document.execCommand('justifyFull');break;case 10:document.execCommand('indent');break;case 11:document.execCommand('outdent');break;case 12:document.execCommand('insertOrderedList');break;case 13:document.execCommand('insertUnorderedList');break;case 14:document.execCommand('insertHTML',false,'—');break;};};