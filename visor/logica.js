var datos_juego='';var carga_archivo=document.createElement('input');carga_archivo.setAttribute('type','file');var lector;var dialogo_actual;var tam_fuente=16;window.onbeforeunload=s=>'';function mostrar(accion){let elem=document.getElementById('contenido_opciones');if(accion===true){let estilo=window.getComputedStyle(elem);let display=estilo.getPropertyValue('display');if(display==='none'){elem.style.display='flex';};if(display==='flex'){elem.style.display='none';};};if(accion===false){elem.style.display='none';};};function cambiar(direccion){if(direccion){tam_fuente+=2;}else{tam_fuente-=2;};if(tam_fuente<16){tam_fuente=16;}if(tam_fuente>28){tam_fuente=28;}document.getElementById('contenido').style.fontSize=tam_fuente.toString()+'px';document.getElementById('opciones').style.fontSize=tam_fuente.toString()+'px';};function pantalla(){if(document.documentElement.requestFullscreen){mostrar(false);document.documentElement.requestFullscreen();};};function cargar_juego(){carga_archivo.setAttribute('onchange','abrir_juego()');carga_archivo.setAttribute('accept','.hpg');carga_archivo.click();};function abrir_juego(){let archivo=carga_archivo.files[0];lector=new FileReader();lector.readAsText(archivo);lector.onload=cargar_datos_juego;lector.onerror=mostrar_error;};function cargar_datos_juego(){mostrar(false);let parsear=lector.result;datos_juego=JSON.parse(parsear);document.getElementById('titulo').innerHTML=datos_juego['titulo'];window.document.title=datos_juego['titulo'];dialogo_actual=parseInt(datos_juego['inicio'],10);cargar_nodo(dialogo_actual,true);};function cargar_nodo(nodo,inicio){let nodo_extraido=datos_juego['datos'][nodo];if(nodo_extraido!==undefined){mostrar(false);dialogo_actual=nodo;let cantidad_opciones=nodo_extraido['opciones'].length;document.getElementById('elecciones').innerHTML='';for(let i=0;i<cantidad_opciones;i++){let elem_div=document.createElement('div');elem_div.className='boton eleccion';elem_div.onclick=function(){cargar_nodo(nodo_extraido['opciones'][i]['direccion'],false)};elem_div.innerHTML=nodo_extraido['opciones'][i]['texto'];document.getElementById('elecciones').appendChild(elem_div);};document.getElementById('contenido').innerHTML=nodo_extraido['texto'];}else{alert('Error - El dialogo que fue especificado no existe.');};};function cargar_partida(){carga_archivo.setAttribute('onchange','abrir_partida()');carga_archivo.setAttribute('accept','.agn');carga_archivo.click();};function abrir_partida(){let archivo=carga_archivo.files[0];lector=new FileReader();lector.readAsText(archivo);lector.onload=cargar_datos_partida;lector.onerror=mostrar_error;};function cargar_datos_partida(){mostrar(false);let parsear=lector.result;let partida_guardada=JSON.parse(parsear);cargar_nodo(partida_guardada['guardado'],false);};function guardar(){if(datos_juego!==undefined){mostrar(false);let texto_guardar='';let datos_guardar={};datos_guardar['guardado']=dialogo_actual;texto_guardar+=JSON.stringify(datos_guardar);elemento=document.createElement('a');elemento.setAttribute('href','data:text/plain;charset=utf-8,'+encodeURIComponent(texto_guardar));elemento.setAttribute('download',document.getElementById('titulo').innerHTML+'_g.agn');elemento.click();elemento.delete;};};function mostrar_error(){alert('Ha habido un error al cargar el archivo.');};